{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Client = void 0;\nconst auth_1 = require(\"@vonage/auth\");\nconst vetch_1 = require(\"@vonage/vetch\");\nconst AuthenticationType_1 = require(\"./enums/AuthenticationType\");\nconst transfomers = __importStar(require(\"./transformers\"));\nconst debug_1 = __importDefault(require(\"debug\"));\nconst log = (0, debug_1.default)('vonage:server-client');\nclass Client {\n  static transformers = transfomers;\n  authType;\n  auth;\n  config;\n  constructor(credentials, options) {\n    // eslint-disable-next-line max-len\n    this.auth = !Object.prototype.hasOwnProperty.call(credentials, 'getQueryParams') ? new auth_1.Auth(credentials) : credentials;\n    this.config = {\n      restHost: options?.restHost || 'https://rest.nexmo.com',\n      apiHost: options?.apiHost || 'https://api.nexmo.com',\n      videoHost: options?.videoHost || 'https://video.api.vonage.com',\n      meetingsHost: options?.meetingsHost || 'https://api-eu.vonage.com',\n      proactiveHost: options?.proactiveHost || 'https://api-eu.vonage.com',\n      responseType: options?.responseType || vetch_1.ResponseTypes.json,\n      timeout: options?.timeout || null\n    };\n  }\n  async addAuthenticationToRequest(request) {\n    let requestPath = 'data';\n    log(`adding ${this.authType || 'api key/secret'} to request`);\n    switch (this.authType) {\n      case AuthenticationType_1.AuthenticationType.BASIC:\n        request.headers = Object.assign({}, request.headers, {\n          Authorization: await this.auth.createBasicHeader()\n        });\n        return request;\n      case AuthenticationType_1.AuthenticationType.JWT:\n        request.headers = Object.assign({}, request.headers, {\n          Authorization: await this.auth.createBearerHeader()\n        });\n        return request;\n      case AuthenticationType_1.AuthenticationType.QUERY_KEY_SECRET:\n        requestPath = 'params';\n      // falls through\n      case AuthenticationType_1.AuthenticationType.KEY_SECRET:\n      default:\n    }\n    if (['GET', 'DELETE'].includes(request.method)) {\n      requestPath = 'params';\n    }\n    const authParams = await this.auth.getQueryParams({});\n    let params = {\n      ...request[requestPath],\n      ...authParams\n    };\n    // This is most likely web-form\n    if (!request[requestPath] && this.authType !== AuthenticationType_1.AuthenticationType.QUERY_KEY_SECRET) {\n      requestPath = 'body';\n      params = new URLSearchParams({\n        ...Object.fromEntries(request.body.entries()),\n        ...authParams\n      });\n    }\n    request[requestPath] = params;\n    return request;\n  }\n  async sendDeleteRequest(url) {\n    const request = {\n      url,\n      method: vetch_1.HTTPMethods.DELETE\n    };\n    return await this.sendRequest(request);\n  }\n  async sendFormSubmitRequest(url, payload) {\n    const request = {\n      url,\n      method: vetch_1.HTTPMethods.POST,\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      },\n      ...(payload ? {\n        body: new URLSearchParams(payload)\n      } : {})\n    };\n    return await this.sendRequest(request);\n  }\n  async sendGetRequest(url, queryParams) {\n    const request = {\n      url,\n      method: vetch_1.HTTPMethods.GET,\n      ...(queryParams ? {\n        params: queryParams\n      } : {})\n    };\n    return await this.sendRequest(request);\n  }\n  async sendPatchRequest(url, payload) {\n    return this.sendRequestWithData(vetch_1.HTTPMethods.PATCH, url, payload);\n  }\n  async sendPostRequest(url, payload) {\n    return this.sendRequestWithData(vetch_1.HTTPMethods.POST, url, payload);\n  }\n  sendPutRequest(url, payload) {\n    return this.sendRequestWithData(vetch_1.HTTPMethods.PUT, url, payload);\n  }\n  async sendRequestWithData(method, url, payload) {\n    const request = {\n      url,\n      method: method,\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      ...(payload ? {\n        data: payload\n      } : {})\n    };\n    return await this.sendRequest(request);\n  }\n  async sendRequest(request) {\n    request.timeout = this.config.timeout;\n    request = await this.addAuthenticationToRequest(request);\n    const vetch = new vetch_1.Vetch(this.config);\n    const result = await vetch.request(request);\n    return result;\n  }\n}\nexports.Client = Client;","map":{"version":3,"names":["auth_1","require","vetch_1","AuthenticationType_1","transfomers","__importStar","debug_1","__importDefault","log","default","Client","transformers","authType","auth","config","constructor","credentials","options","Object","prototype","hasOwnProperty","call","Auth","restHost","apiHost","videoHost","meetingsHost","proactiveHost","responseType","ResponseTypes","json","timeout","addAuthenticationToRequest","request","requestPath","AuthenticationType","BASIC","headers","assign","Authorization","createBasicHeader","JWT","createBearerHeader","QUERY_KEY_SECRET","KEY_SECRET","includes","method","authParams","getQueryParams","params","URLSearchParams","fromEntries","body","entries","sendDeleteRequest","url","HTTPMethods","DELETE","sendRequest","sendFormSubmitRequest","payload","POST","sendGetRequest","queryParams","GET","sendPatchRequest","sendRequestWithData","PATCH","sendPostRequest","sendPutRequest","PUT","data","vetch","Vetch","result","exports"],"sources":["../lib/client.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}