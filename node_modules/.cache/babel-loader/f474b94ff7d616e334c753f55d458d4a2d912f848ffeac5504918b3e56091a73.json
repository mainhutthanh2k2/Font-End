{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Voice = void 0;\nconst server_client_1 = require(\"@vonage/server-client\");\nconst vetch_1 = require(\"@vonage/vetch\");\nconst apiCallsToCalls = call => {\n  delete call._links;\n  const transformedCall = server_client_1.Client.transformers.camelCaseObjectKeys(call, true, true);\n  delete transformedCall.conversationUuid;\n  return {\n    ...transformedCall,\n    conversationUUID: call.conversation_uuid\n  };\n};\nclass Voice extends server_client_1.Client {\n  authType = server_client_1.AuthenticationType.JWT;\n  async *getAllCalls(params = {}) {\n    let next = null;\n    params.recordIndex = params?.recordIndex || 0;\n    do {\n      const resp = await this.getCallsPage(params);\n      yield* resp?._embedded?.calls.map(apiCallsToCalls);\n      next = resp?._links?.next ? new URL(resp._links.next.href) : null;\n      if (next) {\n        params.recordIndex = parseInt(next.searchParams.get('record_index'));\n      }\n    } while (next);\n  }\n  async getCallsPage(params) {\n    const resp = await this.sendGetRequest(`${this.config.apiHost}/v1/calls`, server_client_1.Client.transformers.snakeCaseObjectKeys(params));\n    return {\n      ...resp.data\n    };\n  }\n  async search(filter) {\n    return this.getCallsPage(filter);\n  }\n  async getCall(uuid) {\n    const resp = await this.sendGetRequest(`${this.config.apiHost}/v1/calls/${uuid}`);\n    return apiCallsToCalls(resp.data);\n  }\n  async createOutboundCall(call) {\n    const resp = await this.sendPostRequest(`${this.config.apiHost}/v1/calls`, server_client_1.Client.transformers.snakeCaseObjectKeys(call, true));\n    const result = server_client_1.Client.transformers.camelCaseObjectKeys(resp.data, true, true);\n    delete result.conversationUuid;\n    result.conversationUUID = resp.data.conversation_uuid;\n    return result;\n  }\n  async playDTMF(uuid, digits) {\n    const resp = await this.sendPutRequest(`${this.config.apiHost}/v1/calls/${uuid}/dtmf`, {\n      digits: digits\n    });\n    return server_client_1.Client.transformers.snakeCaseObjectKeys(resp.data, true, true);\n  }\n  async playTTS(uuid, action) {\n    delete action.action;\n    delete action.bargeIn;\n    const resp = await this.sendPutRequest(`${this.config.apiHost}/v1/calls/${uuid}/talk`, server_client_1.Client.transformers.snakeCaseObjectKeys(action));\n    return server_client_1.Client.transformers.snakeCaseObjectKeys(resp.data, true, true);\n  }\n  async stopTTS(uuid) {\n    const resp = await this.sendDeleteRequest(`${this.config.apiHost}/v1/calls/${uuid}/talk`);\n    return server_client_1.Client.transformers.snakeCaseObjectKeys(resp.data, true, true);\n  }\n  async streamAudio(uuid, url, loop = 1, volumeLevel = 0.0) {\n    const resp = await this.sendPutRequest(`${this.config.apiHost}/v1/calls/${uuid}/stream`, {\n      stream_url: [url],\n      loop,\n      level: String(volumeLevel)\n    });\n    return server_client_1.Client.transformers.snakeCaseObjectKeys(resp.data, true, true);\n  }\n  async stopStreamAudio(uuid) {\n    const resp = await this.sendDeleteRequest(`${this.config.apiHost}/v1/calls/${uuid}/stream`);\n    return server_client_1.Client.transformers.snakeCaseObjectKeys(resp.data, true, true);\n  }\n  async transferCallWithNCCO(uuid, ncco) {\n    return this.callAction(uuid, 'transfer', {\n      type: 'ncco',\n      ncco: ncco\n    });\n  }\n  async transferCallWithURL(uuid, url) {\n    return this.callAction(uuid, 'transfer', {\n      type: 'ncco',\n      url: [url]\n    });\n  }\n  async hangupCall(uuid) {\n    return this.callAction(uuid, 'hangup');\n  }\n  async muteCall(uuid) {\n    return this.callAction(uuid, 'mute');\n  }\n  async unmuteCall(uuid) {\n    return this.callAction(uuid, 'unmute');\n  }\n  async earmuffCall(uuid) {\n    return this.callAction(uuid, 'earmuff');\n  }\n  async unearmuffCall(uuid) {\n    return this.callAction(uuid, 'unearmuff');\n  }\n  async downloadRecording(file, path) {\n    const config = this.config;\n    config.responseType = vetch_1.ResponseTypes.stream;\n    const client = new server_client_1.FileClient(this.auth, config);\n    return await client.downloadFile(file, path);\n  }\n  async downloadTranscription(file, path) {\n    const config = this.config;\n    config.responseType = vetch_1.ResponseTypes.text;\n    const client = new server_client_1.FileClient(this.auth, config);\n    return await client.downloadFile(file, path);\n  }\n  async callAction(uuid, action, destination) {\n    await this.sendPutRequest(`${this.config.apiHost}/v1/calls/${uuid}`, {\n      action: action,\n      ...(destination ? {\n        destination: destination\n      } : {})\n    });\n  }\n}\nexports.Voice = Voice;","map":{"version":3,"names":["server_client_1","require","vetch_1","apiCallsToCalls","call","_links","transformedCall","Client","transformers","camelCaseObjectKeys","conversationUuid","conversationUUID","conversation_uuid","Voice","authType","AuthenticationType","JWT","getAllCalls","params","next","recordIndex","resp","getCallsPage","_embedded","calls","map","URL","href","parseInt","searchParams","get","sendGetRequest","config","apiHost","snakeCaseObjectKeys","data","search","filter","getCall","uuid","createOutboundCall","sendPostRequest","result","playDTMF","digits","sendPutRequest","playTTS","action","bargeIn","stopTTS","sendDeleteRequest","streamAudio","url","loop","volumeLevel","stream_url","level","String","stopStreamAudio","transferCallWithNCCO","ncco","callAction","type","transferCallWithURL","hangupCall","muteCall","unmuteCall","earmuffCall","unearmuffCall","downloadRecording","file","path","responseType","ResponseTypes","stream","client","FileClient","auth","downloadFile","downloadTranscription","text","destination","exports"],"sources":["../lib/voice.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}