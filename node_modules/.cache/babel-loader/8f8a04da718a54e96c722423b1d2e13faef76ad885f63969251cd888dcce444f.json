{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Numbers = void 0;\nconst server_client_1 = require(\"@vonage/server-client\");\nconst Feature_1 = require(\"./enums/Feature\");\nconst SearchPattern_1 = require(\"./enums/SearchPattern\");\nconst lodash_omit_1 = __importDefault(require(\"lodash.omit\"));\nconst remapObjects = (mapping, newObject, oldObject) => {\n  for (const key in mapping) {\n    if (oldObject[mapping[key]]) {\n      newObject[key] = oldObject[mapping[key]];\n      delete oldObject[mapping[key]];\n    }\n  }\n  newObject = {\n    ...newObject,\n    ...oldObject\n  };\n  return newObject;\n};\nconst buildSearch = ({\n  endsWith,\n  startsWith,\n  contains,\n  searchPattern,\n  pattern,\n  country\n}) => {\n  searchPattern = searchPattern ?? SearchPattern_1.SearchPattern.CONTAINS;\n  if (pattern) {\n    return {\n      search_pattern: searchPattern,\n      pattern: pattern,\n      country: country\n    };\n  }\n  // order of precdent contains, endsWith, startsWith\n  if (contains) {\n    return {\n      search_pattern: SearchPattern_1.SearchPattern.CONTAINS,\n      pattern: contains,\n      country: country\n    };\n  }\n  if (endsWith) {\n    return {\n      search_pattern: SearchPattern_1.SearchPattern.ENDS_WITH,\n      pattern: endsWith,\n      country: country\n    };\n  }\n  if (startsWith) {\n    return {\n      search_pattern: SearchPattern_1.SearchPattern.START_WITH,\n      pattern: startsWith,\n      country: country\n    };\n  }\n  return {};\n};\nconst sortFeatures = features => {\n  // API expects these as a CSV in a specific order\n  if (features.length > 4) {\n    throw new Error('Invalid number of features request');\n  }\n  if (features.length === 1) {\n    return features.join();\n  }\n  if (features.length === 3) {\n    return [Feature_1.Feature.SMS, Feature_1.Feature.MMS, Feature_1.Feature.VOICE].join(',');\n  }\n  const newOrder = [];\n  if (features.includes(Feature_1.Feature.SMS)) {\n    newOrder.push(Feature_1.Feature.SMS);\n  }\n  if (features.includes(Feature_1.Feature.VOICE)) {\n    newOrder.push(Feature_1.Feature.VOICE);\n  }\n  if (features.includes(Feature_1.Feature.MMS)) {\n    newOrder.push(Feature_1.Feature.MMS);\n  }\n  return newOrder.join(',');\n};\nclass Numbers extends server_client_1.Client {\n  authType = server_client_1.AuthenticationType.QUERY_KEY_SECRET;\n  async buyNumber(params) {\n    const mapping = {\n      target_api_key: 'targetApiKey'\n    };\n    const data = remapObjects(mapping, {}, params);\n    const resp = await this.sendFormSubmitRequest(`${this.config.restHost}/number/buy`, data);\n    return {\n      errorCode: resp.data['error-code'],\n      errorCodeLabel: resp.data['error-code-label']\n    };\n  }\n  async cancelNumber(params) {\n    const mapping = {\n      target_api_key: 'targetApiKey'\n    };\n    const data = remapObjects(mapping, {}, params);\n    const resp = await this.sendFormSubmitRequest(`${this.config.restHost}/number/cancel`, data);\n    return {\n      errorCode: resp.data['error-code'],\n      errorCodeLabel: resp.data['error-code-label']\n    };\n  }\n  async getAvailableNumbers(filter) {\n    const mapping = {\n      search_pattern: 'searchPattern'\n    };\n    const data = (0, lodash_omit_1.default)(remapObjects(mapping, {}, {\n      ...filter,\n      ...buildSearch(filter)\n    }), ['startsWith', 'contains', 'endsWith', 'searchPattern']);\n    if (data.features?.length > 0) {\n      data.features = sortFeatures(data.features);\n    }\n    const resp = await this.sendGetRequest(`${this.config.restHost}/number/search`, data);\n    return resp.data;\n  }\n  async getOwnedNumbers(filter) {\n    if (!filter) {\n      filter = {};\n    }\n    const resp = await this.sendGetRequest(`${this.config.restHost}/account/numbers`, server_client_1.Client.transformers.snakeCaseObjectKeys(filter));\n    return resp.data;\n  }\n  async updateNumber(params) {\n    const mapping = {\n      app_id: 'applicationId'\n    };\n    const data = remapObjects(mapping, {}, params);\n    const resp = await this.sendFormSubmitRequest(`${this.config.restHost}/number/update`, data);\n    return {\n      errorCode: resp.data['error-code'],\n      errorCodeLabel: resp.data['error-code-label']\n    };\n  }\n}\nexports.Numbers = Numbers;","map":{"version":3,"names":["server_client_1","require","Feature_1","SearchPattern_1","lodash_omit_1","__importDefault","remapObjects","mapping","newObject","oldObject","key","buildSearch","endsWith","startsWith","contains","searchPattern","pattern","country","SearchPattern","CONTAINS","search_pattern","ENDS_WITH","START_WITH","sortFeatures","features","length","Error","join","Feature","SMS","MMS","VOICE","newOrder","includes","push","Numbers","Client","authType","AuthenticationType","QUERY_KEY_SECRET","buyNumber","params","target_api_key","data","resp","sendFormSubmitRequest","config","restHost","errorCode","errorCodeLabel","cancelNumber","getAvailableNumbers","filter","default","sendGetRequest","getOwnedNumbers","transformers","snakeCaseObjectKeys","updateNumber","app_id","exports"],"sources":["../lib/numbers.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}