{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.JWT = void 0;\nconst jsonwebtoken_1 = require(\"jsonwebtoken\");\nconst uuid_1 = require(\"uuid\");\nconst index_1 = require(\"./errors/index\");\nconst debug_1 = __importDefault(require(\"debug\"));\nconst log = (0, debug_1.default)('vonage:jwt');\nclass JWT {\n  tokenGenerate(applicationId, privateKey, opts) {\n    log(`Application id: ${applicationId}`);\n    log(`Private key: ${privateKey}`);\n    if (!applicationId) {\n      throw new index_1.MissingApplicationIdError();\n    }\n    if (!privateKey) {\n      throw new index_1.MissingPrivateKeyError();\n    }\n    if (typeof applicationId !== 'string') {\n      throw new index_1.InvalidApplicationIdError();\n    }\n    if (typeof privateKey !== 'string' && !(privateKey instanceof Buffer)) {\n      throw new index_1.InvalidPrivateKeyError();\n    }\n    const claims = this.validateOptions(opts);\n    log('Claims', claims);\n    claims.application_id = applicationId;\n    return (0, jsonwebtoken_1.sign)(claims, privateKey, {\n      algorithm: 'RS256',\n      header: {\n        typ: 'JWT',\n        alg: 'RS256'\n      }\n    });\n  }\n  verifySignature(jwt, privateKey) {\n    try {\n      (0, jsonwebtoken_1.verify)(jwt, privateKey, {\n        algorithms: ['RS256']\n      });\n      return true;\n    } catch (error) {\n      log('Error when verifying token', error);\n    }\n    return false;\n  }\n  validateOptions(opts) {\n    const now = parseInt((Date.now() / 1000).toString(), 10);\n    const ttl = opts?.ttl || 900;\n    if (opts?.ttl) {\n      delete opts.ttl;\n    }\n    const claims = {\n      ...opts,\n      jti: opts?.jti || (0, uuid_1.v4)(),\n      iat: opts?.issued_at || now,\n      exp: now + ttl\n    };\n    if (opts?.subject) {\n      claims.sub = opts.subject;\n    }\n    if (opts?.acl) {\n      claims.acl = opts.acl;\n    }\n    for (const property in opts) {\n      // eslint-disable-next-line\n      if (opts.hasOwnProperty(property)) {\n        claims[property] = opts[property];\n      }\n    }\n    return claims;\n  }\n}\nexports.JWT = JWT;","map":{"version":3,"names":["jsonwebtoken_1","require","uuid_1","index_1","debug_1","__importDefault","log","default","JWT","tokenGenerate","applicationId","privateKey","opts","MissingApplicationIdError","MissingPrivateKeyError","InvalidApplicationIdError","Buffer","InvalidPrivateKeyError","claims","validateOptions","application_id","sign","algorithm","header","typ","alg","verifySignature","jwt","verify","algorithms","error","now","parseInt","Date","toString","ttl","jti","v4","iat","issued_at","exp","subject","sub","acl","property","hasOwnProperty","exports"],"sources":["../lib/jwt.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}