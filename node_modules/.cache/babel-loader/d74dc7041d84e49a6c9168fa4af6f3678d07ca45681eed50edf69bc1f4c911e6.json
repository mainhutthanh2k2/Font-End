{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Users = void 0;\nconst server_client_1 = require(\"@vonage/server-client\");\nconst apiUserToUser = apiUser => {\n  const user = server_client_1.Client.transformers.camelCaseObjectKeys(apiUser, true);\n  delete user.links;\n  delete user.properties?.customData;\n  if (apiUser.properties) {\n    user.properties.customData = apiUser.properties?.custom_data;\n  }\n  if (apiUser?.channels?.websocket) {\n    user.channels.websocket = apiUser.channels.websocket.map(apiSocket => {\n      const socket = {\n        uri: apiSocket.uri\n      };\n      if (apiSocket['content-type']) {\n        socket.contentType = apiSocket['content-type'];\n      }\n      if (apiSocket.headers) {\n        socket.headers = apiSocket.headers;\n      }\n      return socket;\n    });\n  }\n  return user;\n};\nconst userToAPI = user => {\n  const apiUser = server_client_1.Client.transformers.snakeCaseObjectKeys(user, true);\n  // preserve user properties\n  if (apiUser.properties?.custom_data) {\n    apiUser.properties.custom_data = user.properties.customData;\n  }\n  // Websockets will change when transformed\n  if (apiUser.channels?.websocket) {\n    apiUser.channels.websocket = user.channels.websocket.map(socket => {\n      const apiSocket = {\n        uri: socket.uri\n      };\n      // restore content type\n      if (socket.contentType) {\n        apiSocket['content-type'] = socket.contentType;\n      }\n      // preserve headers\n      if (socket.headers) {\n        apiSocket.headers = socket.headers;\n      }\n      return apiSocket;\n    });\n  }\n  delete apiUser.id;\n  return apiUser;\n};\nclass Users extends server_client_1.Client {\n  authType = server_client_1.AuthenticationType.JWT;\n  async *listAllUsers(params = {}) {\n    let cursor = params.cursor;\n    do {\n      if (cursor) {\n        params.cursor = cursor;\n      }\n      const resp = await this.getUserPage(params);\n      yield* resp._embedded?.users.map(apiUserToUser);\n      const next = resp._links?.next?.href ? new URL(resp._links.next.href) : null;\n      cursor = next ? next.searchParams.get('cursor') : null;\n    } while (cursor);\n  }\n  async getUserPage(params = {}) {\n    const resp = await this.sendGetRequest(`${this.config.apiHost}/v1/users`, server_client_1.Client.transformers.snakeCaseObjectKeys(params, true));\n    return resp.data;\n  }\n  async createUser(user) {\n    const resp = await this.sendPostRequest(`${this.config.apiHost}/v1/users`, userToAPI(user));\n    return apiUserToUser(resp.data);\n  }\n  async getUser(userId) {\n    const resp = await this.sendGetRequest(`${this.config.apiHost}/v1/users/${userId}`);\n    return apiUserToUser(resp.data);\n  }\n  async updateUser(user) {\n    const resp = await this.sendPutRequest(`${this.config.apiHost}/v1/users/${user.id}`, userToAPI(user));\n    return apiUserToUser(resp.data);\n  }\n  async deleteUser(userId) {\n    await this.sendDeleteRequest(`${this.config.apiHost}/v1/users/${userId}`);\n  }\n}\nexports.Users = Users;","map":{"version":3,"names":["server_client_1","require","apiUserToUser","apiUser","user","Client","transformers","camelCaseObjectKeys","links","properties","customData","custom_data","channels","websocket","map","apiSocket","socket","uri","contentType","headers","userToAPI","snakeCaseObjectKeys","id","Users","authType","AuthenticationType","JWT","listAllUsers","params","cursor","resp","getUserPage","_embedded","users","next","_links","href","URL","searchParams","get","sendGetRequest","config","apiHost","data","createUser","sendPostRequest","getUser","userId","updateUser","sendPutRequest","deleteUser","sendDeleteRequest","exports"],"sources":["../lib/user.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}